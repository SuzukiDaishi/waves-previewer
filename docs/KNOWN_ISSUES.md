# 既知の注意点 / 制限

- Windows で `waves-previewer.exe` を実行中のまま再ビルドすると「アクセスが拒否されました（OS error 5）」で失敗します。実行中のアプリを終了してからビルドしてください。
- README などの日本語が文字化けする場合があります。全ファイルを UTF-8 (BOM 無し) で保存してください。UI 側は Windows で Meiryo/Yu Gothic/MS Gothic を動的読み込みし、豆腐文字を軽減します。
- ループ範囲は Inspector > LoopEdit や K/P ショートカットで編集できますが、Undo/Redo は未実装です。Apply Xfade など破壊的操作を行う場合は保存前にバックアップ（または新規書き出し）を推奨します。
- 再生はモノラル合成（全チャンネル平均）→全チャンネルへ複製。定位情報は保持しません。
- リサンプルは簡易線形。高品質 SRC はロードマップ項目。
- Wave 列の行高は列幅変化に追随して 1 フレーム遅延で更新されます（計測→次フレーム適用）。
- 非対応の出力フォーマットやデバイスで CPAL が開けない場合があります。現状はデフォルト出力のみを使用しています。
- PitchShift/TimeStretch はファイルサイズやパラメータにより処理時間がかかることがあります。処理中はUIをブロックするローディングカバーを表示します。
- Windows で signalsmith-stretch を使う場合、LLVM（libclang.dll）が必須です。`LIBCLANG_PATH` の設定が必要な環境があります。

■ ラウドネス（LUFS）に関する注意
- 本実装は 48 kHz へ簡易リサンプル後、BS.1770 のK-weighting／ゲートで LUFS(I) を算出します。厳密な係数再設計は今後の改善項目です。
- LUFS(I) は Gain 変更に即時追従するため表示上は `base + gain` の近似を出します。数百ms後に厳密再計算で確定します。
- −70 LUFS 近傍ではゲート通過/不通過が反転し、近似と厳密値が一時的に異なる場合があります（最終的には厳密側へ収束）。
- マルチチャンネル重みは現状すべて 1.0（LFE除外は未対応）。将来、サラウンド +1.5 dB の重み付けに対応予定です。

■ オーバーレイ（緑）と背景の厳密一致
- ズーム最遠（Aggregated）で列が合わない問題を修正済み（px列ロック+可視窓比率マッピング）。
- 端列（最初/最後）の 1px で ±1 サンプルの丸め誤差が出る場合があります。実害はありませんが、必要に応じて端列のスナップを追加予定です。
- Debug ビルドではズーム/マッピングの eprintln を有効化して診断可能です（パフォーマンスに注意）。

■ エディタの時間ズーム/パンについて（改善済み・注意点）
- 取得経路を強化しました：`raw_scroll_delta` に加えて低レベルイベント `Event::Scroll` / `Event::Zoom`（ピンチ）も併用し、環境差でホイールが 0 になるケースを軽減しています。
- キャンバス上のポインタ位置を矩形判定で検出し、hover 取りこぼしで無効化される問題を回避しています。
- それでも環境依存で挙動が弱い場合があります（高分解能ホイール、OS のジェスチャ設定等）。
  - 対策: キャンバス上にポインタを置いた状態で操作／トラックパッドはピンチを使用／Shift+ホイールでパン。
  - デバッグ（開発ビルド）: 操作時に `stderr` へ `wheel_raw=... pinch=...` を出力します。値が常に 0 の場合はプラットフォーム統合層で吸収されている可能性があります。
  - 再現ケースがあれば issue へログと環境（OS/デバイス）を添えてご報告ください。

パフォーマンス関連（大規模リスト）
- 1万〜3万件規模のリストは仮想化で十分軽快に動作しますが、初回のメタ計算（RMS/サムネ）はバックグラウンドで順次行われるため、すべての行に値が出揃うまでに時間がかかります。
- さらなる高速化を行う場合は以下を検討してください:
  - 可視範囲優先のメタ生成キュー（優先/通常の二段階キュー）。
  - 文字列の構築結果（表示名/親パス文字列）のキャッシュ化。
  - サムネbinsの上限を 128–256 程度に固定して再描画コストを一定に。

# UX / デザインメモ

## 基本方針
- 一覧→クリック→即試聴（Space）→必要ならタブで詳細、の最短導線。
- ダーク基調 + 寒色アクセント。コントラストは高め、罫線は控えめ。
- 小画面でも崩れない：上部ツールバーは折り返し（`horizontal_wrapped`）。

## リスト
- `TableBuilder` を直接使用（内部スクロール）。`min_scrolled_height` でテーブルの枠を最下部まで伸ばす。
- 行は仮想化（`TableBody::rows`）で可視範囲のみ描画。1万〜3万件規模でも軽快。
- 列はリサイズ可。Wave 列を広げると、サムネの縦サイズも幅に比例して大きくなる。
  - `thumb_h ≒ available_width * 0.22` を目安。
  - 行高は 1 フレーム遅延で更新（先頭行の計測値を `wave_row_h` に保存）。
- dBFS 列は背景を値で着色。パレットを増やし、静音=黒 → 深青 → 青 → シアン/緑 → 黄 → 橙 → 赤 と段階的に変化。
- 列: File | Folder | Ch | SR | Bits | Level(dBFS) | Wave。
- ヘッダクリックで並び替え（文字列はUTF順、数値は大小順）。同じヘッダを再クリックで「昇順→降順→元の順」の三段階トグル。
- 上部バー: 総数表示（例: `Files: 123`／読み込み中は `⏳` 表示）、音量、Mode（Speed/Pitch/Stretch）セグメント、各モードの数値（小型ステッパ: DragValue）、検索バー、dBFS メータ、再生ボタン。
  - Speed/Stretch: 0.25〜4.0 の倍率、2桁小数、`x` サフィックス。
  - Pitch: -12.0〜+12.0 st、1桁小数、`st` サフィックス。
  - 入力中の自動上書きを避け、確定値のみ反映。全コントロールの高さを統一し、横幅占有を最小化。
- クリック動作:
  - 行背景: 選択（同時に音声ロード）。
  - ファイル名セル: エディタタブで開く（同時に選択）。
  - フォルダセル: OS のファイルブラウザで開く（同時に選択）。
- ↑/↓：選択移動、Enter：タブを開く。

## エディタ
- 大波形は `wave_h = clamp(width * 0.35, 180, available_height)`。
- グリッドは 5 分割の水平線、波形は縦棒(min/max)で高速描画。
- ループ：ボタンまたは L キーで On/Off（現状は全範囲）。Pitch/Stretch の処理後は出力レイテンシ/flush を考慮して末尾欠けを防止し、継ぎ目の引っかかりを低減。
- プレイヘッドは 60fps 目安で更新（`request_repaint_after(16ms)`）。

## ローディング / 重い処理の扱い
- PitchShift/TimeStretch はファイルサイズやパラメータにより時間がかかるため、処理中は画面全体にカバー（半透明）＋スピナーを表示して入力をブロック。
- 処理完了後、波形と再生バッファを差し替え、自動でループ範囲を全体に再設定。

## 色設計
- サムネ/エディタの各棒の色は振幅 `a = max(|min|,|max|)` を 0..1 に正規化し、
  - `lerp(Blue(80,200,255), Red(255,70,70), a^0.6)` で補間。
- dBFS 列は `-80..+6 dBFS` を、黒→青→シアン→赤のトーンで補間。

## フォント
- Windows では Meiryo / Yu Gothic / MS Gothic を動的読み込み（なければデフォルト）。
- 非 UTF-8 が混入した場合は ASCII 表示へフォールバック。
